## 动机
khronos 这家公司唯一的贡献就是vulkan c api的设计, 除此之外，其他方面的表现则较为一般。

接下来我们来分析一下它的一些设计决策。

### opengl
首先是 OpenGL，它的状态机设计一直备受批评。刚开始我以为 OpenGL 在那个时代是一个比较先进的设计，但后来才了解到，其实在那个时期，这样的设计就已经存在许多问题。

OpenGL 的状态机设计非常混乱，多个全局变量与状态函数的结合，让开发者容易陷入迷惑。虽然它为很多开发者提供了方便，但也带来了许多不必要的复杂性和难以维护的问题。

这可以说是 Khronos 的第一个设计瑕疵，且影响深远。

### 命名
Khronos 的命名规范也是一个让人诟病的方面，尤其是在 OpenGL 中，命名风格的混乱使得代码的可读性和一致性大打折扣。具体来说，有几个问题值得注意：

* 无意义的简写：许多命名都采用了过度简化的缩写，使得代码含义不明确。
* 大小驼峰混用：
* 不规范的前缀使用：前缀的选择不符合逻辑，增加了理解成本。
* 自相矛盾的命名规范：很多时候，Khronos 自己的命名规范也没有得到统一遵循。

我们来看一些具体的例子：
![img.png](../../resource/img.png)

* PFNXXX: 这个命名的前缀显得很不清晰，PFN 是什么意思？为什么要使用全大写的无意义缩写？这种命名方式让人难以理解。
* GLint, GLsizei: 这些命名在视觉上看似像是驼峰命名，但实际上并不是。 sizei是什么鬼
* glUniformMatrix3fv: 这个命名又引入了 gl 前缀, 写了半天终于知道驼峰怎么写了, 然后搞出来个fv

这些问题并不是因为时代局限性造成的，而是设计时未充分考虑命名规范的后果。

#### Vulkan 命名问题
![img.png](../../resource/img2.png)  
![img.png](../../resource/img_2.png)  
![img_1.png](../../resource/img_1.png)  
乍一看似没什么毛病, 统一用驼峰, 名称也很规范  
实际上依然是依托答辩  
若把opengl的命名比做是刚学代码的人用a,B,CC,d2, d3给变量一通乱命名的话, 那么vulkan就是代码写了段时间, 被无数前辈骂过后, 知道变量命名不能用abcd了  
得写个有意义的名字, 于是就造出了什么VkAppleStruct, VkAppleEnum, 这一堆看似有意义, 实则什么都没表述出来, 依然是一坨的屎, 只是一眼看上去不会觉得是屎罢了  

来评鉴一下vulkan这坨屎:
* VkDisplayModePropertiesKHR, displayMode: 大小驼峰混用的问题，displayMode 和 Properties 之间不应当同时使用不同的命名风格。
* VkMemoryHeapFlagBits, VkMemoryHeap: 通辽语法  

问题的根源在于，命名不应当仅仅为了规范而规范，而是应该能够清晰传递信息，避免过度依赖语法结构来命名。
>为什么作为类名称的时候就用大驼峰, 作为变量的时候就用小驼峰?   
#### 偷懒:  
那我不是能写出来这样的代码: List list; 看似说了什么实则只说了个list, 一个list写两遍?    
如果我不按语法结构区分命名, 那么我只能写出这样的代码: List Students; 同样是两个词, 信息量翻了一倍   
为了省事将类型名换个命名方式, 而不考虑命名位students这样更有意的名称, 这就是在偷懒 
#### 耦合:  
考虑以下代码:
```cpp
namespace a{ struct Apple{}; }
namespace b{ using ::a::Apple; }
```
若按照vulkan的逻辑, 那么当这个Apple由类型变成函数或者变量时, 就得重命名为`apple`, 这时候b命名空间里的代码也得跟着变:
```cpp
namespace a{ static int const apple = 0; }
namespace b{ using ::a::apple; }
```
这就是一种耦合! 这跟匈牙利命名那种耦合变量名和类型信息的有什么区别, 只是匈牙利命名更臭名昭著一些

尤其是 Vulkan 中的 sType, pNext, pXXX 等命名方式，这种强耦合的设计让变量名和类型信息绑定过紧，造成了很多不必要的复杂性。
> 比如displayName不叫pDisplayName 这时候知道这个p有点多余了, 但给其他变量起名字的时候就光想着偷懒了

### vulkan c++
Vulkan 的 C++ 库，虽然打着 C++ 的旗号，但在设计上仍然存在许多问题。例如：  
![img.png](../../resource/img_3.png)  
它引入了一些不必要的宿主头文件，使用标准库中的 <string>, <vector>, <map> 等。
![img.png](../../resource/img_4.png)
这些库使用起来不像是 C++ 原生的设计，反而给人一种 Java 风格的感觉，缺乏 C++ 原有的灵活性和效率。

这样的设计使得 Vulkan C++ 库的使用体验大打折扣，很多时候似乎并没有充分利用 C++ 的优势，反而让人感到混乱和不方便。